<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Kas Masjid - Cloud Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f8fafc;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        @media print {
            .no-print { display: none !important; }
            .print-container {
                width: 100% !important;
                padding: 0 !important;
                box-shadow: none !important;
                border: none !important;
            }
            @page { size: A4; margin: 1cm; }
        }

        .spinner {
            border: 3px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #059669;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-slate-900">

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-white z-[100] flex flex-col items-center justify-center">
        <div class="spinner mb-4"></div>
        <p class="text-sm font-bold text-slate-500 uppercase tracking-widest">Menghubungkan ke Cloud...</p>
    </div>

    <!-- Auth UI -->
    <div id="authSection" class="hidden min-h-screen flex items-center justify-center p-4 bg-emerald-50">
        <div class="bg-white w-full max-w-md p-8 rounded-2xl shadow-xl border border-emerald-100">
            <div class="text-center mb-8">
                <div class="inline-flex p-4 bg-emerald-600 text-white rounded-2xl shadow-lg mb-4">
                    <i class="fas fa-mosque fa-2x"></i>
                </div>
                <h1 class="text-2xl font-black text-slate-800 uppercase tracking-tighter">Login Kas Masjid</h1>
                <p class="text-slate-400 text-xs font-bold uppercase tracking-widest mt-1">Akses Database Cloud</p>
            </div>
            <div id="authError" class="hidden mb-4 p-3 bg-rose-50 text-rose-600 text-xs font-bold rounded-lg border border-rose-100"></div>
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Email</label>
                    <input type="email" id="email" required class="w-full px-4 py-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-emerald-500" placeholder="admin@masjid.com">
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Password</label>
                    <input type="password" id="password" required class="w-full px-4 py-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-emerald-500" placeholder="••••••••">
                </div>
                <button type="submit" class="w-full bg-emerald-600 text-white font-bold py-3 rounded-xl hover:bg-emerald-700 transition-all shadow-md active:scale-95">
                    Masuk Sekarang
                </button>
            </form>
            <p class="text-center mt-6 text-[10px] text-slate-400 font-medium uppercase tracking-widest">Aplikasi Keuangan Sabilil Muttaqin</p>
        </div>
    </div>

    <!-- App UI -->
    <div id="appSection" class="hidden">
        <!-- Header -->
        <header class="bg-white border-b border-slate-200 sticky top-0 z-40 no-print">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex flex-col md:flex-row md:items-center justify-between py-2 md:py-0">
                    <div class="flex items-center justify-between py-4">
                        <div class="flex items-center gap-3 text-emerald-600">
                            <div class="bg-emerald-600 text-white p-2 rounded-xl shadow-md">
                                <i class="fas fa-wallet"></i>
                            </div>
                            <div>
                                <h1 class="font-black text-lg tracking-tighter leading-none uppercase">KAS CLOUD</h1>
                                <p id="headerMosqueName" class="text-[10px] text-slate-400 font-bold uppercase tracking-widest leading-none mt-1">SABILIL MUTTAQIN</p>
                            </div>
                        </div>
                        <button id="logoutBtn" class="md:hidden text-slate-400 hover:text-rose-500"><i class="fas fa-sign-out-alt"></i></button>
                    </div>

                    <nav class="flex items-center overflow-x-auto no-scrollbar -mx-4 md:mx-0">
                        <button onclick="switchView('dashboard')" class="nav-btn active flex items-center gap-2 px-6 py-4 border-b-2 border-transparent transition-all text-sm uppercase tracking-wider text-slate-500 hover:text-slate-700">
                            <i class="fas fa-th-large"></i> Dashboard
                        </button>
                        <button onclick="switchView('transactions')" class="nav-btn flex items-center gap-2 px-6 py-4 border-b-2 border-transparent transition-all text-sm uppercase tracking-wider text-slate-500 hover:text-slate-700">
                            <i class="fas fa-book"></i> Buku Kas
                        </button>
                        <button onclick="switchView('reports')" class="nav-btn flex items-center gap-2 px-6 py-4 border-b-2 border-transparent transition-all text-sm uppercase tracking-wider text-slate-500 hover:text-slate-700">
                            <i class="fas fa-print"></i> Laporan
                        </button>
                        <button onclick="logout()" class="hidden md:flex items-center gap-2 px-6 py-4 text-slate-400 hover:text-rose-500 transition-all text-sm uppercase tracking-wider font-bold">
                            <i class="fas fa-sign-out-alt"></i> Keluar
                        </button>
                    </nav>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 min-h-screen">
            <!-- View Containers -->
            <div id="view-dashboard" class="view-content space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-4">
                        <div class="p-4 bg-emerald-100 text-emerald-600 rounded-full"><i class="fas fa-arrow-up text-xl"></i></div>
                        <div>
                            <p class="text-xs text-slate-500 uppercase tracking-widest font-bold">Total Pemasukan</p>
                            <p id="statIncome" class="text-2xl font-bold text-slate-800">Rp 0</p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-4">
                        <div class="p-4 bg-rose-100 text-rose-600 rounded-full"><i class="fas fa-arrow-down text-xl"></i></div>
                        <div>
                            <p class="text-xs text-slate-500 uppercase tracking-widest font-bold">Total Pengeluaran</p>
                            <p id="statExpense" class="text-2xl font-bold text-slate-800">Rp 0</p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-4 border-l-4 border-l-emerald-500">
                        <div class="p-4 bg-blue-100 text-blue-600 rounded-full"><i class="fas fa-university text-xl"></i></div>
                        <div>
                            <p class="text-xs text-slate-500 uppercase tracking-widest font-bold">Saldo Kas</p>
                            <p id="statBalance" class="text-2xl font-bold text-slate-800">Rp 0</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-transactions" class="view-content hidden space-y-4">
                <div class="flex justify-between items-center bg-white p-4 rounded-xl border border-slate-100 shadow-sm">
                    <h2 class="text-lg font-bold text-slate-800 uppercase tracking-tight ml-2">Riwayat Kas</h2>
                    <button onclick="openModal()" class="bg-emerald-600 text-white px-4 py-2 rounded-lg font-bold flex items-center gap-2 hover:bg-emerald-700 transition-all shadow-md active:scale-95">
                        <i class="fas fa-plus"></i> Tambah Transaksi
                    </button>
                </div>
                <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 text-slate-400 text-[10px] uppercase tracking-widest">
                                <tr>
                                    <th class="px-4 py-3 font-bold">Tanggal</th>
                                    <th class="px-4 py-3 font-bold">Keterangan</th>
                                    <th class="px-4 py-3 font-bold text-right">Nominal</th>
                                    <th class="px-4 py-3 font-bold text-center">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="transactionList" class="divide-y divide-slate-100">
                                <!-- Data injected via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="view-reports" class="view-content hidden space-y-6">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100 no-print">
                    <div class="flex flex-wrap gap-4 items-end">
                        <div class="flex-1 min-w-[150px]">
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Filter Bulan</label>
                            <select id="reportMonth" class="w-full px-3 py-2 border border-slate-200 rounded-lg outline-none focus:ring-2 focus:ring-emerald-500">
                                <!-- Generated JS -->
                            </select>
                        </div>
                        <button onclick="window.print()" class="bg-slate-800 text-white px-6 py-2 rounded-lg font-bold hover:bg-slate-900 flex items-center gap-2">
                            <i class="fas fa-print"></i> Cetak Laporan
                        </button>
                    </div>
                </div>

                <div id="printableArea" class="bg-white p-8 md:p-12 shadow-lg rounded-xl print-container">
                    <div class="text-center mb-10 border-b-4 border-slate-900 pb-6">
                        <h1 class="text-xl font-black text-slate-900 uppercase tracking-tight">LAPORAN KEUANGAN KAS MASJID</h1>
                        <h2 id="reportMosqueName" class="text-3xl font-black text-slate-900 uppercase tracking-widest mt-1">SABILIL MUTTAQIN</h2>
                        <p id="reportPeriodText" class="text-slate-600 font-bold uppercase tracking-widest text-xs mt-3">Januari 2024</p>
                    </div>
                    
                    <table class="w-full border-collapse border border-slate-900 text-xs">
                        <thead>
                            <tr class="bg-slate-100 uppercase">
                                <th class="border border-slate-900 px-3 py-2 w-8">No</th>
                                <th class="border border-slate-900 px-3 py-2">Tanggal</th>
                                <th class="border border-slate-900 px-3 py-2 text-left">Uraian</th>
                                <th class="border border-slate-900 px-3 py-2 text-right">Debet</th>
                                <th class="border border-slate-900 px-3 py-2 text-right">Kredit</th>
                                <th class="border border-slate-900 px-3 py-2 text-right">Saldo</th>
                            </tr>
                        </thead>
                        <tbody id="reportTableBody">
                            <!-- Injected JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Form -->
    <div id="modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm">
        <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden">
            <div class="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                <h3 id="modalTitle" class="text-lg font-bold text-slate-800 uppercase tracking-tighter">Tambah Transaksi</h3>
                <button onclick="closeModal()" class="text-slate-400 hover:text-slate-600"><i class="fas fa-times"></i></button>
            </div>
            <form id="transactionForm" class="p-6 space-y-4">
                <input type="hidden" id="editId">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-[10px] font-bold text-slate-500 uppercase mb-1 tracking-widest">Tanggal</label>
                        <input type="date" id="tDate" required class="w-full px-3 py-2 rounded-lg border border-slate-200 outline-none focus:ring-2 focus:ring-emerald-500">
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-slate-500 uppercase mb-1 tracking-widest">Jenis</label>
                        <select id="tType" class="w-full px-3 py-2 rounded-lg border border-slate-200 outline-none focus:ring-2 focus:ring-emerald-500">
                            <option value="Pemasukan">Pemasukan</option>
                            <option value="Pengeluaran">Pengeluaran</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-[10px] font-bold text-slate-500 uppercase mb-1 tracking-widest">Uraian / Keterangan</label>
                    <input type="text" id="tDesc" required class="w-full px-3 py-2 rounded-lg border border-slate-200 outline-none focus:ring-2 focus:ring-emerald-500" placeholder="Infaq Jumat, dll">
                </div>
                <div>
                    <label class="block text-[10px] font-bold text-slate-500 uppercase mb-1 tracking-widest">Nominal (Rp)</label>
                    <input type="number" id="tAmount" required class="w-full px-3 py-2 rounded-lg border border-slate-200 outline-none focus:ring-2 focus:ring-emerald-500 font-bold text-lg text-emerald-600" placeholder="0">
                </div>
                <div class="flex gap-3 pt-4 border-t border-slate-100">
                    <button type="button" onclick="closeModal()" class="flex-1 py-2 bg-slate-100 text-slate-500 font-bold rounded-lg hover:bg-slate-200 uppercase tracking-widest text-[10px]">Batal</button>
                    <button type="submit" class="flex-[2] py-2 bg-emerald-600 text-white font-bold rounded-lg hover:bg-emerald-700 shadow-md uppercase tracking-widest text-[10px]">Simpan Transaksi</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, addDoc, onSnapshot, updateDoc, deleteDoc, query, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Configuration
        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'masjid-finance-default';

        // Global State
        let currentUser = null;
        let allTransactions = [];
        const months = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];

        // UI Selectors
        const loadingOverlay = document.getElementById('loadingOverlay');
        const authSection = document.getElementById('authSection');
        const appSection = document.getElementById('appSection');
        const transactionList = document.getElementById('transactionList');
        const loginForm = document.getElementById('loginForm');
        const authError = document.getElementById('authError');

        // Init Auth (Follow RULE 3)
        const initAuth = async () => {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    // Fallback to anonymous for preview if no credentials provided
                    // Normally user would login via form
                }
            } catch (err) {
                console.error("Auth init error:", err);
            }
        };
        initAuth();

        onAuthStateChanged(auth, (user) => {
            loadingOverlay.classList.add('hidden');
            if (user) {
                currentUser = user;
                authSection.classList.add('hidden');
                appSection.classList.remove('hidden');
                setupDataSync(user.uid);
            } else {
                appSection.classList.add('hidden');
                authSection.classList.remove('hidden');
            }
        });

        // Data Sync (Follow RULE 1 & 2)
        const setupDataSync = (userId) => {
            const dataPath = `/artifacts/${appId}/public/data/transactions`; // Using public path for collaborative data
            const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'transactions'));

            onSnapshot(q, (snapshot) => {
                allTransactions = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }))
                    .sort((a, b) => new Date(a.date) - new Date(b.date));
                updateUI();
            }, (error) => {
                console.error("Firestore Listen Error:", error);
            });
        };

        // UI Handlers
        window.switchView = (viewName) => {
            document.querySelectorAll('.view-content').forEach(v => v.classList.add('hidden'));
            document.getElementById(`view-${viewName}`).classList.remove('hidden');
            
            document.querySelectorAll('.nav-btn').forEach(b => {
                b.classList.remove('border-emerald-600', 'text-emerald-600', 'font-bold', 'bg-emerald-50/30');
                if (b.innerText.toLowerCase().includes(viewName)) {
                    b.classList.add('border-emerald-600', 'text-emerald-600', 'font-bold', 'bg-emerald-50/30');
                }
            });

            if (viewName === 'reports') renderReport();
        };

        const updateUI = () => {
            // Stats
            const income = allTransactions.reduce((sum, t) => t.type === 'Pemasukan' ? sum + Number(t.amount) : sum, 0);
            const expense = allTransactions.reduce((sum, t) => t.type === 'Pengeluaran' ? sum + Number(t.amount) : sum, 0);
            const balance = income - expense;

            document.getElementById('statIncome').innerText = formatCurrency(income);
            document.getElementById('statExpense').innerText = formatCurrency(expense);
            document.getElementById('statBalance').innerText = formatCurrency(balance);

            // Transaction List
            transactionList.innerHTML = '';
            [...allTransactions].reverse().forEach(t => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-slate-50 transition-colors";
                tr.innerHTML = `
                    <td class="px-4 py-4 text-slate-500 text-[11px] font-bold">${formatDateShort(t.date)}</td>
                    <td class="px-4 py-4 font-bold text-slate-800 text-xs uppercase tracking-tight">${t.description}</td>
                    <td class="px-4 py-4 text-right font-black ${t.type === 'Pemasukan' ? 'text-emerald-600' : 'text-rose-600'}">
                        ${t.type === 'Pemasukan' ? '+' : '-'} ${Number(t.amount).toLocaleString('id-ID')}
                    </td>
                    <td class="px-4 py-4 text-center space-x-2">
                        <button onclick="editTransaction('${t.id}')" class="text-blue-500 p-1"><i class="fas fa-edit"></i></button>
                        <button onclick="deleteTransaction('${t.id}')" class="text-rose-400 p-1"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                transactionList.appendChild(tr);
            });
        };

        const renderReport = () => {
            const select = document.getElementById('reportMonth');
            const [selectedYear, selectedMonth] = select.value.split('-').map(Number);
            
            // 1. Calculate Previous Balance
            let prevBalance = 0;
            const currentRows = [];
            
            allTransactions.forEach(t => {
                const d = new Date(t.date);
                const tYear = d.getFullYear();
                const tMonth = d.getMonth() + 1;

                if (tYear < selectedYear || (tYear === selectedYear && tMonth < selectedMonth)) {
                    if (t.type === 'Pemasukan') prevBalance += Number(t.amount);
                    else prevBalance -= Number(t.amount);
                } else if (tYear === selectedYear && tMonth === selectedMonth) {
                    currentRows.push(t);
                }
            });

            // 2. Render Table
            const tbody = document.getElementById('reportTableBody');
            tbody.innerHTML = '';

            // Row 1: Saldo Awal
            const trAwal = document.createElement('tr');
            trAwal.className = "bg-slate-50 italic";
            trAwal.innerHTML = `
                <td class="border border-slate-900 px-2 py-2 text-center">1</td>
                <td class="border border-slate-900 px-2 py-2">-</td>
                <td class="border border-slate-900 px-2 py-2 font-black uppercase">SALDO BULAN SEBELUMNYA</td>
                <td class="border border-slate-900 px-2 py-2 text-right">-</td>
                <td class="border border-slate-900 px-2 py-2 text-right">-</td>
                <td class="border border-slate-900 px-2 py-2 text-right font-black">${prevBalance.toLocaleString('id-ID')}</td>
            `;
            tbody.appendChild(trAwal);

            let running = prevBalance;
            currentRows.forEach((t, i) => {
                if (t.type === 'Pemasukan') running += Number(t.amount);
                else running -= Number(t.amount);

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="border border-slate-900 px-2 py-2 text-center">${i + 2}</td>
                    <td class="border border-slate-900 px-2 py-2 text-center uppercase font-bold">${formatDateShort(t.date)}</td>
                    <td class="border border-slate-900 px-2 py-2 font-bold uppercase">${t.description}</td>
                    <td class="border border-slate-900 px-2 py-2 text-right">${t.type === 'Pemasukan' ? Number(t.amount).toLocaleString('id-ID') : '-'}</td>
                    <td class="border border-slate-900 px-2 py-2 text-right">${t.type === 'Pengeluaran' ? Number(t.amount).toLocaleString('id-ID') : '-'}</td>
                    <td class="border border-slate-900 px-2 py-2 text-right font-black bg-slate-50">${running.toLocaleString('id-ID')}</td>
                `;
                tbody.appendChild(tr);
            });

            document.getElementById('reportPeriodText').innerText = `${months[selectedMonth-1]} ${selectedYear}`;
        };

        // Actions
        window.openModal = (id = null) => {
            const modal = document.getElementById('modal');
            const form = document.getElementById('transactionForm');
            form.reset();
            document.getElementById('editId').value = '';
            document.getElementById('modalTitle').innerText = 'Tambah Transaksi';
            document.getElementById('tDate').value = new Date().toISOString().split('T')[0];

            if (id) {
                const t = allTransactions.find(x => x.id === id);
                document.getElementById('editId').value = id;
                document.getElementById('tDate').value = t.date;
                document.getElementById('tType').value = t.type;
                document.getElementById('tDesc').value = t.description;
                document.getElementById('tAmount').value = t.amount;
                document.getElementById('modalTitle').innerText = 'Edit Transaksi';
            }
            modal.classList.remove('hidden');
        };

        window.closeModal = () => document.getElementById('modal').classList.add('hidden');

        document.getElementById('transactionForm').onsubmit = async (e) => {
            e.preventDefault();
            if (!currentUser) return;

            const id = document.getElementById('editId').value;
            const data = {
                date: document.getElementById('tDate').value,
                type: document.getElementById('tType').value,
                description: document.getElementById('tDesc').value,
                amount: Number(document.getElementById('tAmount').value),
                updatedAt: new Date().toISOString(),
                createdBy: currentUser.uid
            };

            try {
                const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'transactions');
                if (id) {
                    await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'transactions', id), data);
                } else {
                    await addDoc(colRef, data);
                }
                closeModal();
            } catch (err) {
                console.error("Save Error:", err);
            }
        };

        window.deleteTransaction = async (id) => {
            if (confirm('Hapus transaksi ini?')) {
                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'transactions', id));
            }
        };

        window.logout = () => signOut(auth);

        loginForm.onsubmit = async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            authError.classList.add('hidden');
            
            try {
                await signInWithEmailAndPassword(auth, email, pass);
            } catch (err) {
                authError.innerText = "Email atau Password salah. Silakan coba lagi.";
                authError.classList.remove('hidden');
            }
        };

        // Helpers
        const formatCurrency = (n) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(n);
        const formatDateShort = (s) => {
            const d = new Date(s);
            return `${d.getDate()}/${d.getMonth()+1}/${d.getFullYear()}`;
        };

        // Init Filters
        const initFilters = () => {
            const select = document.getElementById('reportMonth');
            const now = new Date();
            for(let i=0; i<12; i++) {
                const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const val = `${d.getFullYear()}-${d.getMonth()+1}`;
                const label = `${months[d.getMonth()]} ${d.getFullYear()}`;
                const opt = new Option(label, val);
                select.add(opt);
            }
            select.onchange = renderReport;
        };
        initFilters();

        // Make functions globally available for inline onclick
        window.editTransaction = openModal;
    </script>
</body>
</html>
