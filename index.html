<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Keuangan Masjid Sabilil Muttaqin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .tab-active {
            background-color: #065f46;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .gradient-bg {
            background: linear-gradient(135deg, #065f46 0%, #064e3b 100%);
        }

        @media print {
            .no-print { display: none !important; }
            body { background: white; padding: 0; }
            .print-area { box-shadow: none !important; border: none !important; margin: 0 !important; width: 100% !important; }
            table { font-size: 11px !important; }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #059669; border-radius: 10px; }
    </style>
</head>
<body class="bg-[#f8fafc] min-h-screen text-slate-900">

    <!-- Sidebar / Nav -->
    <aside class="fixed left-0 top-0 h-full w-64 gradient-bg text-white hidden lg:flex flex-col z-50 no-print">
        <div class="p-8">
            <h2 class="text-xl font-bold flex items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-emerald-300" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2L4.5 20.29L5.21 21L12 18L18.79 21L19.5 20.29L12 2Z"/>
                </svg>
                <span class="leading-tight">Sabilil<br>Muttaqin</span>
            </h2>
        </div>
        
        <nav class="flex-1 px-4 space-y-2 mt-4">
            <button onclick="switchTab('dashboard')" id="btn-dashboard" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 hover:bg-white/10">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                </svg>
                Dashboard
            </button>
            <button onclick="switchTab('transaksi')" id="btn-transaksi" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 hover:bg-white/10">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                Transaksi
            </button>
            <button onclick="switchTab('laporan')" id="btn-laporan" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 hover:bg-white/10">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                Laporan
            </button>
            <button onclick="switchTab('pengaturan')" id="btn-pengaturan" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 hover:bg-white/10">
                <svg xmlns="http://www.w3.org/2000/xl" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                Pengaturan
            </button>
        </nav>

        <div class="p-6">
            <div class="bg-emerald-800/50 p-4 rounded-2xl text-xs text-emerald-200 border border-emerald-700">
                <p>Versi 2.0 - Desain Elegan</p>
                <p>Â© 2024 Sabilil Muttaqin</p>
            </div>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="lg:ml-64 p-4 md:p-10">
        
        <!-- Mobile Header -->
        <header class="flex lg:hidden justify-between items-center mb-8 bg-white p-4 rounded-2xl shadow-sm no-print">
            <h2 class="font-bold text-emerald-800">Sabilil Muttaqin</h2>
            <div class="flex gap-4 overflow-x-auto text-xs py-2">
                <button onclick="switchTab('dashboard')" class="px-3 py-1 bg-emerald-50 text-emerald-700 rounded-lg">Home</button>
                <button onclick="switchTab('transaksi')" class="px-3 py-1 bg-emerald-50 text-emerald-700 rounded-lg">Kas</button>
                <button onclick="switchTab('laporan')" class="px-3 py-1 bg-emerald-50 text-emerald-700 rounded-lg">Lapor</button>
            </div>
        </header>

        <!-- DASHBOARD TAB -->
        <section id="tab-dashboard" class="tab-content space-y-8 animate-in fade-in duration-500">
            <div>
                <h1 class="text-3xl font-bold text-slate-800">Selamat Datang</h1>
                <p class="text-slate-500">Ringkasan keuangan Masjid Sabilil Muttaqin hari ini.</p>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="glass-card p-6 rounded-[2rem] shadow-xl shadow-slate-200/50 flex flex-col justify-between h-44 relative overflow-hidden group">
                    <div class="absolute -right-4 -top-4 bg-emerald-500/10 w-24 h-24 rounded-full group-hover:scale-150 transition-transform duration-500"></div>
                    <div class="bg-emerald-100 text-emerald-600 w-10 h-10 rounded-xl flex items-center justify-center mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
                    </div>
                    <div>
                        <p class="text-slate-500 text-sm font-medium">Total Pemasukan</p>
                        <h2 id="dash-pemasukan" class="text-2xl font-bold text-slate-800">Rp 0</h2>
                    </div>
                </div>

                <div class="glass-card p-6 rounded-[2rem] shadow-xl shadow-slate-200/50 flex flex-col justify-between h-44 relative overflow-hidden group">
                    <div class="absolute -right-4 -top-4 bg-rose-500/10 w-24 h-24 rounded-full group-hover:scale-150 transition-transform duration-500"></div>
                    <div class="bg-rose-100 text-rose-600 w-10 h-10 rounded-xl flex items-center justify-center mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4" /></svg>
                    </div>
                    <div>
                        <p class="text-slate-500 text-sm font-medium">Total Pengeluaran</p>
                        <h2 id="dash-pengeluaran" class="text-2xl font-bold text-slate-800">Rp 0</h2>
                    </div>
                </div>

                <div class="bg-emerald-900 text-white p-6 rounded-[2rem] shadow-xl shadow-emerald-900/20 flex flex-col justify-between h-44 relative overflow-hidden">
                    <div class="absolute -right-10 -bottom-10 bg-white/10 w-40 h-40 rounded-full"></div>
                    <div class="bg-white/20 text-white w-10 h-10 rounded-xl flex items-center justify-center mb-4 backdrop-blur-md">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" /></svg>
                    </div>
                    <div>
                        <p class="text-emerald-300 text-sm font-medium">Sisa Saldo Kas</p>
                        <h2 id="dash-saldo" class="text-2xl font-bold">Rp 0</h2>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="bg-white rounded-[2rem] p-8 shadow-sm border border-slate-100">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-bold text-xl text-slate-800">Transaksi Terbaru</h3>
                    <button onclick="switchTab('transaksi')" class="px-4 py-2 text-emerald-600 text-sm font-semibold hover:bg-emerald-50 rounded-xl transition">Lihat Seluruh Riwayat</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead>
                            <tr class="text-slate-400 text-sm border-b border-slate-50">
                                <th class="pb-4 font-medium">TANGGAL</th>
                                <th class="pb-4 font-medium">URAIAN</th>
                                <th class="pb-4 font-medium text-right">NOMINAL</th>
                            </tr>
                        </thead>
                        <tbody id="recent-transactions-list" class="divide-y divide-slate-50">
                            <!-- Data injected via JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- TRANSAKSI TAB -->
        <section id="tab-transaksi" class="tab-content hidden animate-in slide-in-from-bottom-4 duration-500">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                <!-- Form -->
                <div class="lg:col-span-4">
                    <div class="bg-white p-8 rounded-[2rem] shadow-xl shadow-slate-200/50 border border-slate-100 sticky top-10">
                        <h3 class="font-bold text-xl mb-6 text-slate-800" id="form-title">Input Kas</h3>
                        <form id="transaction-form" class="space-y-5">
                            <input type="hidden" id="edit-index" value="-1">
                            <div>
                                <label class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block">Tanggal</label>
                                <input type="date" id="tgl" required class="w-full bg-slate-50 p-4 rounded-2xl border-none ring-1 ring-slate-200 focus:ring-2 focus:ring-emerald-500 outline-none transition">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block">Alur Kas</label>
                                <select id="jenis" required class="w-full bg-slate-50 p-4 rounded-2xl border-none ring-1 ring-slate-200 focus:ring-2 focus:ring-emerald-500 outline-none transition appearance-none">
                                    <option value="Pemasukan">Pemasukan (+)</option>
                                    <option value="Pengeluaran">Pengeluaran (-)</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block">Keterangan</label>
                                <textarea id="uraian" rows="3" placeholder="Contoh: Infaq Kotak Jumat" required class="w-full bg-slate-50 p-4 rounded-2xl border-none ring-1 ring-slate-200 focus:ring-2 focus:ring-emerald-500 outline-none transition"></textarea>
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block">Jumlah (Rp)</label>
                                <input type="number" id="nominal" placeholder="0" required class="w-full bg-slate-50 p-4 rounded-2xl border-none ring-1 ring-slate-200 focus:ring-2 focus:ring-emerald-500 outline-none transition font-bold text-lg">
                            </div>
                            <div class="flex gap-3 pt-4">
                                <button type="submit" class="flex-1 bg-emerald-600 text-white py-4 rounded-2xl font-bold hover:bg-emerald-700 shadow-lg shadow-emerald-200 transition-all active:scale-95">Simpan Data</button>
                                <button type="button" onclick="resetForm()" class="bg-slate-100 text-slate-600 px-6 py-4 rounded-2xl hover:bg-slate-200 transition">Batal</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Table -->
                <div class="lg:col-span-8 space-y-4">
                    <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                        <h3 class="font-bold text-2xl text-slate-800">Buku Kas</h3>
                        <div class="relative w-full md:w-72">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                            <input type="text" id="search" placeholder="Cari transaksi..." onkeyup="renderTable()" class="w-full bg-white pl-12 pr-4 py-3 rounded-2xl shadow-sm border border-slate-100 outline-none focus:ring-2 focus:ring-emerald-500">
                        </div>
                    </div>

                    <div class="bg-white rounded-[2rem] overflow-hidden shadow-xl shadow-slate-200/50 border border-slate-100">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="bg-slate-50/50 text-slate-400 text-[10px] uppercase tracking-widest">
                                    <tr>
                                        <th class="p-6">No</th>
                                        <th class="p-6">Tanggal</th>
                                        <th class="p-6">Uraian</th>
                                        <th class="p-6 text-right">Nominal</th>
                                        <th class="p-6 text-right">Saldo</th>
                                        <th class="p-6 text-center">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="main-table-body" class="divide-y divide-slate-50">
                                    <!-- JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- LAPORAN TAB -->
        <section id="tab-laporan" class="tab-content hidden">
            <!-- Filter Bar -->
            <div class="bg-white p-8 rounded-[2rem] shadow-xl shadow-slate-200/50 border border-slate-100 no-print mb-10">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 items-end">
                    <div>
                        <label class="text-xs font-bold text-slate-400 uppercase mb-2 block">Jenis Laporan</label>
                        <select id="filter-tipe" class="w-full bg-slate-50 p-3 rounded-xl border-none ring-1 ring-slate-200 focus:ring-2 focus:ring-emerald-500">
                            <option value="bulanan">Bulanan</option>
                            <option value="tahunan">Tahunan</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-400 uppercase mb-2 block">Periode</label>
                        <div class="flex gap-2">
                            <select id="filter-bulan" class="w-full bg-slate-50 p-3 rounded-xl border-none ring-1 ring-slate-200 focus:ring-2 focus:ring-emerald-500">
                                <option value="0">Januari</option><option value="1">Februari</option><option value="2">Maret</option>
                                <option value="3">April</option><option value="4">Mei</option><option value="5">Juni</option>
                                <option value="6">Juli</option><option value="7">Agustus</option><option value="8">September</option>
                                <option value="9">Oktober</option><option value="10">November</option><option value="11">Desember</option>
                            </select>
                            <select id="filter-tahun" class="w-full bg-slate-50 p-3 rounded-xl border-none ring-1 ring-slate-200 focus:ring-2 focus:ring-emerald-500"></select>
                        </div>
                    </div>
                    <div class="md:col-span-2 flex gap-3">
                        <button onclick="generateReport()" class="flex-1 bg-emerald-600 text-white py-3 rounded-xl font-bold hover:bg-emerald-700 transition active:scale-95 shadow-lg shadow-emerald-100">Proses Data</button>
                        <button onclick="window.print()" class="bg-slate-800 text-white px-6 py-3 rounded-xl font-bold hover:bg-slate-900 transition flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" /></svg>
                            Cetak
                        </button>
                    </div>
                </div>
            </div>

            <!-- PRINTABLE AREA -->
            <div id="print-area" class="bg-white p-12 rounded-3xl shadow-2xl mx-auto max-w-5xl print-area">
                <div class="text-center mb-10">
                    <h2 id="print-nama-masjid" class="text-3xl font-black text-emerald-900 uppercase tracking-tight">Nama Masjid</h2>
                    <p id="print-alamat-masjid" class="text-slate-500 mt-2 font-medium">Alamat Masjid Lengkap</p>
                    <div class="w-full h-1 bg-emerald-900 mt-6 mb-2"></div>
                    <div class="w-full h-[1px] bg-emerald-900 mb-6"></div>
                    
                    <h3 id="print-judul-laporan" class="text-xl font-bold text-slate-800 underline underline-offset-8 decoration-2">LAPORAN KAS MASJID</h3>
                    <p id="print-periode" class="font-bold text-slate-600 mt-4 tracking-wider uppercase text-sm">Periode: -</p>
                </div>

                <!-- Langsung Tabel Setelah Judul -->
                <div class="mb-10 overflow-hidden rounded-xl border border-slate-200">
                    <table class="w-full text-sm">
                        <thead class="bg-slate-50">
                            <tr>
                                <th class="border-b p-4 text-center w-12 text-xs font-bold text-slate-400">NO</th>
                                <th class="border-b p-4 text-center w-28 text-xs font-bold text-slate-400">TANGGAL</th>
                                <th class="border-b p-4 text-left text-xs font-bold text-slate-400">URAIAN TRANSAKSI</th>
                                <th class="border-b p-4 text-right w-36 text-xs font-bold text-slate-400">MASUK (RP)</th>
                                <th class="border-b p-4 text-right w-36 text-xs font-bold text-slate-400">KELUAR (RP)</th>
                                <th class="border-b p-4 text-right w-36 text-xs font-bold text-slate-400">SALDO (RP)</th>
                            </tr>
                        </thead>
                        <tbody id="print-table-body" class="divide-y divide-slate-100">
                            <!-- JS -->
                        </tbody>
                    </table>
                </div>

                <!-- Footer Summary & Signatures -->
                <div class="grid grid-cols-2 gap-10">
                    <div>
                        <div class="bg-slate-50 p-6 rounded-2xl border border-slate-100">
                            <h4 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-emerald-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                Ringkasan Kas
                            </h4>
                            <div class="space-y-3 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-slate-500">Pemasukan Periode Ini</span>
                                    <span id="p-total-masuk" class="font-bold text-emerald-600">Rp 0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-500">Pengeluaran Periode Ini</span>
                                    <span id="p-total-keluar" class="font-bold text-rose-600">Rp 0</span>
                                </div>
                                <div class="h-[1px] bg-slate-200"></div>
                                <div class="flex justify-between text-base">
                                    <span class="font-bold text-slate-800">Saldo Akhir</span>
                                    <span id="p-saldo-akhir" class="font-black text-emerald-900">Rp 0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 text-center text-sm pt-4">
                        <div class="space-y-24">
                            <div>
                                <p class="text-slate-400 mb-1">Mengetahui,</p>
                                <p id="print-jabatan-1" class="font-bold text-slate-800">Ketua Takmir</p>
                            </div>
                            <p id="print-nama-1" class="font-bold text-slate-800 border-t border-slate-800 pt-2 inline-block mx-auto min-w-[120px]">Nama Ketua</p>
                        </div>
                        <div class="space-y-24">
                            <div>
                                <p id="print-kota-tgl" class="text-slate-400 mb-1">Kota, Tanggal</p>
                                <p id="print-jabatan-2" class="font-bold text-slate-800">Bendahara</p>
                            </div>
                            <p id="print-nama-2" class="font-bold text-slate-800 border-t border-slate-800 pt-2 inline-block mx-auto min-w-[120px]">Nama Bendahara</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- PENGATURAN TAB -->
        <section id="tab-pengaturan" class="tab-content hidden animate-in zoom-in-95 duration-300">
            <div class="max-w-3xl mx-auto bg-white p-10 rounded-[2.5rem] shadow-xl border border-slate-100">
                <div class="mb-8">
                    <h3 class="font-bold text-2xl text-slate-800">Profil Masjid</h3>
                    <p class="text-slate-500">Sesuaikan informasi identitas yang akan tampil pada laporan cetak.</p>
                </div>
                
                <div class="space-y-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="col-span-full">
                            <label class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 block">Nama Masjid Resmi</label>
                            <input type="text" id="set-masjid" class="w-full bg-slate-50 p-4 rounded-2xl border-none ring-1 ring-slate-200 focus:ring-2 focus:ring-emerald-500 outline-none transition">
                        </div>
                        <div class="col-span-full">
                            <label class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 block">Alamat Masjid</label>
                            <input type="text" id="set-alamat" class="w-full bg-slate-50 p-4 rounded-2xl border-none ring-1 ring-slate-200 focus:ring-2 focus:ring-emerald-500 outline-none transition">
                        </div>
                        <div class="p-6 bg-slate-50 rounded-2xl border border-dashed border-slate-200 space-y-4">
                            <h4 class="text-xs font-black text-slate-400 uppercase">Pejabat 1 (Sisi Kiri)</h4>
                            <input type="text" id="set-jbt1" placeholder="Jabatan" class="w-full bg-white p-3 rounded-xl border border-slate-200 mb-2">
                            <input type="text" id="set-nm1" placeholder="Nama Lengkap" class="w-full bg-white p-3 rounded-xl border border-slate-200">
                        </div>
                        <div class="p-6 bg-slate-50 rounded-2xl border border-dashed border-slate-200 space-y-4">
                            <h4 class="text-xs font-black text-slate-400 uppercase">Pejabat 2 (Sisi Kanan)</h4>
                            <input type="text" id="set-jbt2" placeholder="Jabatan" class="w-full bg-white p-3 rounded-xl border border-slate-200 mb-2">
                            <input type="text" id="set-nm2" placeholder="Nama Lengkap" class="w-full bg-white p-3 rounded-xl border border-slate-200">
                        </div>
                        <div class="col-span-full">
                            <label class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 block">Kota Penerbitan Laporan</label>
                            <input type="text" id="set-kota" class="w-full bg-slate-50 p-4 rounded-2xl border-none ring-1 ring-slate-200 focus:ring-2 focus:ring-emerald-500 outline-none transition">
                        </div>
                    </div>
                    
                    <button onclick="saveSettings()" class="w-full bg-emerald-600 text-white py-4 rounded-2xl font-bold hover:bg-emerald-700 shadow-xl shadow-emerald-100 transition active:scale-[0.98]">Simpan Pengaturan Profil</button>
                    
                    <div class="pt-10 border-t border-slate-100">
                        <div class="bg-rose-50 p-6 rounded-2xl border border-rose-100 flex items-center justify-between">
                            <div>
                                <h4 class="font-bold text-rose-800 uppercase text-xs tracking-widest mb-1">Pembersihan Data</h4>
                                <p class="text-rose-600 text-sm">Hapus seluruh riwayat kas secara permanen.</p>
                            </div>
                            <button onclick="clearData()" class="bg-rose-600 text-white px-6 py-2 rounded-xl font-bold hover:bg-rose-700 text-sm shadow-lg shadow-rose-200 transition">Hapus Semua</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <script>
        // -- STATE --
        let transactions = JSON.parse(localStorage.getItem('masjid_transactions_v2')) || [];
        
        let settings = JSON.parse(localStorage.getItem('masjid_settings_v2')) || {
            nama: "Masjid Sabilil Muttaqin",
            alamat: "Jl. Perintis Kemerdekaan No. 45, Kecamatan Madani",
            jbt1: "Ketua Takmir",
            nm1: "H. Ahmad Muzakki, Lc.",
            jbt2: "Bendahara",
            nm2: "H. Sulaiman Al-Faris",
            kota: "Jakarta Selatan"
        };

        // -- INIT --
        window.onload = () => {
            initYearFilter();
            applySettings();
            updateDashboard();
            renderTable();
            switchTab('dashboard');
            document.getElementById('tgl').valueAsDate = new Date();
        };

        function initYearFilter() {
            const yearSel = document.getElementById('filter-tahun');
            const currentYear = new Date().getFullYear();
            for (let i = currentYear - 3; i <= currentYear + 2; i++) {
                const opt = document.createElement('option');
                opt.value = i; opt.textContent = i;
                if (i === currentYear) opt.selected = true;
                yearSel.appendChild(opt);
            }
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(`tab-${tabId}`).classList.remove('hidden');
            
            // UI Toggle
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('tab-active'));
            document.getElementById(`btn-${tabId}`).classList.add('tab-active');

            if (tabId === 'dashboard') updateDashboard();
        }

        // -- FORMATTING --
        function formatIDR(num) {
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(num);
        }

        // -- CORE LOGIC --
        function calculateWithSaldo(data) {
            const sorted = [...data].sort((a, b) => new Date(a.tgl) - new Date(b.tgl));
            let running = 0;
            return sorted.map(t => {
                if (t.jenis === 'Pemasukan') running += parseFloat(t.nominal);
                else running -= parseFloat(t.nominal);
                return { ...t, saldo: running };
            });
        }

        document.getElementById('transaction-form').onsubmit = (e) => {
            e.preventDefault();
            const index = parseInt(document.getElementById('edit-index').value);
            const newEntry = {
                tgl: document.getElementById('tgl').value,
                jenis: document.getElementById('jenis').value,
                uraian: document.getElementById('uraian').value,
                nominal: parseFloat(document.getElementById('nominal').value)
            };

            if (index === -1) transactions.push(newEntry);
            else transactions[index] = newEntry;

            localStorage.setItem('masjid_transactions_v2', JSON.stringify(transactions));
            resetForm();
            renderTable();
            updateDashboard();
        };

        function resetForm() {
            document.getElementById('transaction-form').reset();
            document.getElementById('edit-index').value = "-1";
            document.getElementById('form-title').innerText = "Input Kas";
            document.getElementById('tgl').valueAsDate = new Date();
        }

        function renderTable() {
            const searchTerm = document.getElementById('search').value.toLowerCase();
            const dataWithSaldo = calculateWithSaldo(transactions);
            const displayData = [...dataWithSaldo].reverse();
            
            const tbody = document.getElementById('main-table-body');
            tbody.innerHTML = displayData
                .filter(t => t.uraian.toLowerCase().includes(searchTerm))
                .map((t, idx) => {
                    const originalIdx = transactions.findIndex(orig => orig.tgl === t.tgl && orig.nominal === t.nominal && orig.uraian === t.uraian);
                    return `
                        <tr class="hover:bg-slate-50 transition group">
                            <td class="p-6 text-slate-400 font-medium text-xs">${displayData.length - idx}</td>
                            <td class="p-6 text-sm text-slate-600">${new Date(t.tgl).toLocaleDateString('id-ID', { day:'2-digit', month:'short' })}</td>
                            <td class="p-6">
                                <span class="font-semibold text-slate-800 block">${t.uraian}</span>
                                <span class="text-[10px] font-bold uppercase ${t.jenis === 'Pemasukan' ? 'text-emerald-500' : 'text-rose-500'} tracking-tighter">${t.jenis}</span>
                            </td>
                            <td class="p-6 text-right font-bold ${t.jenis === 'Pemasukan' ? 'text-emerald-600' : 'text-rose-600'}">
                                ${formatIDR(t.nominal)}
                            </td>
                            <td class="p-6 text-right font-black text-slate-800">
                                ${formatIDR(t.saldo)}
                            </td>
                            <td class="p-6 text-center">
                                <div class="flex justify-center gap-1 opacity-0 group-hover:opacity-100 transition">
                                    <button onclick="editTx(${originalIdx})" class="p-2 bg-slate-100 text-slate-600 rounded-lg hover:bg-emerald-600 hover:text-white transition"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg></button>
                                    <button onclick="deleteTx(${originalIdx})" class="p-2 bg-slate-100 text-slate-600 rounded-lg hover:bg-rose-600 hover:text-white transition"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></button>
                                </div>
                            </td>
                        </tr>`;
                }).join('');
        }

        function editTx(idx) {
            const t = transactions[idx];
            document.getElementById('edit-index').value = idx;
            document.getElementById('tgl').value = t.tgl;
            document.getElementById('jenis').value = t.jenis;
            document.getElementById('uraian').value = t.uraian;
            document.getElementById('nominal').value = t.nominal;
            document.getElementById('form-title').innerText = "Update Kas";
            switchTab('transaksi');
        }

        function deleteTx(idx) {
            if (confirm('Yakin ingin menghapus catatan kas ini?')) {
                transactions.splice(idx, 1);
                localStorage.setItem('masjid_transactions_v2', JSON.stringify(transactions));
                renderTable();
                updateDashboard();
            }
        }

        function updateDashboard() {
            const stats = transactions.reduce((acc, curr) => {
                if (curr.jenis === 'Pemasukan') acc.in += curr.nominal;
                else acc.out += curr.nominal;
                return acc;
            }, { in: 0, out: 0 });

            document.getElementById('dash-pemasukan').innerText = formatIDR(stats.in);
            document.getElementById('dash-pengeluaran').innerText = formatIDR(stats.out);
            document.getElementById('dash-saldo').innerText = formatIDR(stats.in - stats.out);

            const latest = [...transactions].sort((a,b) => new Date(b.tgl) - new Date(a.tgl)).slice(0, 5);
            document.getElementById('recent-transactions-list').innerHTML = latest.map(r => `
                <tr class="group">
                    <td class="py-4 text-xs font-medium text-slate-400">${new Date(r.tgl).toLocaleDateString('id-ID')}</td>
                    <td class="py-4">
                        <span class="block text-sm font-semibold text-slate-700">${r.uraian}</span>
                        <span class="text-[9px] uppercase font-bold ${r.jenis === 'Pemasukan' ? 'text-emerald-500' : 'text-rose-500'} tracking-widest">${r.jenis}</span>
                    </td>
                    <td class="py-4 text-right font-bold text-sm ${r.jenis === 'Pemasukan' ? 'text-emerald-600' : 'text-rose-600'}">${formatIDR(r.nominal)}</td>
                </tr>
            `).join('');
        }

        function generateReport() {
            const tipe = document.getElementById('filter-tipe').value;
            const bln = parseInt(document.getElementById('filter-bulan').value);
            const thn = parseInt(document.getElementById('filter-tahun').value);
            
            let filtered = transactions.filter(t => {
                const d = new Date(t.tgl);
                return tipe === 'bulanan' ? (d.getMonth() === bln && d.getFullYear() === thn) : (d.getFullYear() === thn);
            }).sort((a, b) => new Date(a.tgl) - new Date(b.tgl));

            let prevBalance = transactions
                .filter(t => new Date(t.tgl) < (tipe === 'bulanan' ? new Date(thn, bln, 1) : new Date(thn, 0, 1)))
                .reduce((acc, curr) => curr.jenis === 'Pemasukan' ? acc + curr.nominal : acc - curr.nominal, 0);

            const months = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
            document.getElementById('print-periode').innerText = tipe === 'bulanan' ? `Periode: ${months[bln]} ${thn}` : `Periode: Tahun ${thn}`;
            
            let rows = `
                <tr class="bg-slate-50/50">
                    <td class="border-b p-4 text-center text-slate-400 font-bold">-</td>
                    <td class="border-b p-4 text-center">-</td>
                    <td class="border-b p-4 font-black text-slate-800 uppercase italic">Saldo Awal Sebelum Periode Ini</td>
                    <td class="border-b p-4 text-right">-</td>
                    <td class="border-b p-4 text-right">-</td>
                    <td class="border-b p-4 text-right font-black text-slate-900">${formatIDR(prevBalance)}</td>
                </tr>`;

            let currentSaldo = prevBalance, tIn = 0, tOut = 0;

            filtered.forEach((t, i) => {
                if (t.jenis === 'Pemasukan') { currentSaldo += t.nominal; tIn += t.nominal; }
                else { currentSaldo -= t.nominal; tOut += t.nominal; }

                rows += `
                    <tr>
                        <td class="border-b p-4 text-center text-slate-400">${i+1}</td>
                        <td class="border-b p-4 text-center font-medium">${new Date(t.tgl).toLocaleDateString('id-ID')}</td>
                        <td class="border-b p-4 font-semibold text-slate-700">${t.uraian}</td>
                        <td class="border-b p-4 text-right ${t.jenis === 'Pemasukan' ? 'text-emerald-600' : 'text-slate-300'} font-medium">${t.jenis === 'Pemasukan' ? formatIDR(t.nominal) : '-'}</td>
                        <td class="border-b p-4 text-right ${t.jenis === 'Pengeluaran' ? 'text-rose-600' : 'text-slate-300'} font-medium">${t.jenis === 'Pengeluaran' ? formatIDR(t.nominal) : '-'}</td>
                        <td class="border-b p-4 text-right font-bold text-slate-800">${formatIDR(currentSaldo)}</td>
                    </tr>`;
            });

            document.getElementById('print-table-body').innerHTML = rows;
            document.getElementById('p-total-masuk').innerText = formatIDR(tIn);
            document.getElementById('p-total-keluar').innerText = formatIDR(tOut);
            document.getElementById('p-saldo-akhir').innerText = formatIDR(currentSaldo);

            const today = new Date();
            document.getElementById('print-kota-tgl').innerText = `${settings.kota}, ${today.getDate()} ${months[today.getMonth()]} ${today.getFullYear()}`;
        }

        function applySettings() {
            document.getElementById('print-nama-masjid').innerText = settings.nama;
            document.getElementById('print-alamat-masjid').innerText = settings.alamat;
            document.getElementById('print-jabatan-1').innerText = settings.jbt1;
            document.getElementById('print-nama-1').innerText = settings.nm1;
            document.getElementById('print-jabatan-2').innerText = settings.jbt2;
            document.getElementById('print-nama-2').innerText = settings.nm2;

            document.getElementById('set-masjid').value = settings.nama;
            document.getElementById('set-alamat').value = settings.alamat;
            document.getElementById('set-jbt1').value = settings.jbt1;
            document.getElementById('set-nm1').value = settings.nm1;
            document.getElementById('set-jbt2').value = settings.jbt2;
            document.getElementById('set-nm2').value = settings.nm2;
            document.getElementById('set-kota').value = settings.kota;
        }

        function saveSettings() {
            settings = {
                nama: document.getElementById('set-masjid').value,
                alamat: document.getElementById('set-alamat').value,
                jbt1: document.getElementById('set-jbt1').value,
                nm1: document.getElementById('set-nm1').value,
                jbt2: document.getElementById('set-jbt2').value,
                nm2: document.getElementById('set-nm2').value,
                kota: document.getElementById('set-kota').value
            };
            localStorage.setItem('masjid_settings_v2', JSON.stringify(settings));
            applySettings();
            alert('Profil Masjid Berhasil Diperbarui!');
        }

        function clearData() {
            if (confirm('PERINGATAN! Seluruh data transaksi akan dihapus selamanya. Lanjutkan?')) {
                transactions = [];
                localStorage.setItem('masjid_transactions_v2', JSON.stringify(transactions));
                renderTable();
                updateDashboard();
            }
        }
    </script>
</body>
</html>
